<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kla Sikor VIP - IT ZONE Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #f1c40f; --dark: #0f172a; --card-bg: #1e293b;
            --red: #e11d48; --green: #2ecc71;
        }

        body {
            font-family: 'Kantumruy Pro', sans-serif;
            background: radial-gradient(circle, #1e293b 0%, #0b0f1a 100%);
            color: white; margin: 0; padding-bottom: 160px;
            overflow-x: hidden; touch-action: manipulation;
        }

        .header {
            background: rgba(15, 23, 42, 0.95);
            padding: 15px; border-bottom: 3px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
        }

        .balance-txt { color: var(--gold); font-weight: bold; font-size: 1.3rem; }

        .audio-controls {
            display: flex; gap: 10px; padding: 10px; justify-content: center;
            background: rgba(0,0,0,0.3); margin: 10px; border-radius: 10px;
        }

        .m-btn {
            background: #334155; color: white; border: 1px solid var(--gold);
            padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 0.8rem;
        }

        .game-scene { position: relative; margin: 40px auto; width: 280px; height: 180px; display: flex; justify-content: center; }
        .bowl {
            position: absolute; top: -30px; width: 180px; height: 140px;
            background: linear-gradient(135deg, #fbbf24 0%, #b45309 100%);
            border-radius: 90px 90px 10px 10px; z-index: 20; border: 4px solid var(--gold);
            transition: 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .bowl.open { transform: translateY(-160px) rotate(-15deg); opacity: 0.3; }
        .shaking { animation: shake 0.1s infinite; }
        @keyframes shake { 0% {transform:translate(2px,2px)} 50% {transform:translate(-2px,-2px)} 100% {transform:translate(2px,-2px)} }

        .dice-container { display: flex; gap: 10px; z-index: 10; padding-top: 40px; }
        .dice { width: 55px; height: 55px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .dice img { width: 100%; height: 100%; object-fit: cover; }

        .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; max-width: 450px; margin: 0 auto; }
        .card { 
            background: var(--card-bg); border-radius: 12px; padding: 8px; text-align: center; 
            border: 3px solid transparent; cursor: pointer; position: relative;
        }
        .card img { width: 100%; border-radius: 8px; background: white; aspect-ratio: 1/1; object-fit: cover; }
        .bet-badge { position: absolute; top: -5px; right: -5px; background: var(--red); padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; border: 1px solid white; z-index: 5; }

        .footer {
            position: fixed; bottom: 0; width: 100%; background: var(--dark);
            padding: 15px; border-top: 3px solid var(--gold); display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .main-row { display: flex; gap: 10px; }
        input { width: 100px; padding: 10px; border-radius: 8px; border: none; text-align: center; font-weight: bold; font-size: 1rem; }
        .btn-roll { background: var(--gold); color: black; padding: 10px 40px; border-radius: 8px; border: none; font-weight: bold; font-size: 1.1rem; }

        #msg { position: fixed; top: 25%; left: 50%; transform: translate(-50%, -50%); z-index: 2000; padding: 15px 30px; border-radius: 15px; font-weight: bold; display: none; text-align: center; border: 4px solid white; }
    </style>
</head>
<body>

<div id="msg"></div>

<div class="header">
    <div style="font-weight: bold; color: var(--gold);">IT ZONE GAMING</div>
    <div class="balance-txt">üí∞ <span id="balance">100,000</span> ·üõ</div>
</div>

<div class="audio-controls">
    <button class="m-btn" onclick="manualToggle('bgMusic')">üéµ ·ûÖ·ûò·üí·ûö·üÄ·ûÑ: <span id="bgStatus">OFF</span></button>
    <button class="m-btn" onclick="manualToggle('ambientSound')">üîä ·ûü·üÜ·û°·üÅ·ûÑ·û¢·üä·ûº·û¢·ûö: <span id="amStatus">OFF</span></button>
</div>

<div class="game-scene">
    <div style="position:absolute; bottom:0; width:220px; height:20px; background:#451a03; border-radius:50%; border:3px solid #92400e;"></div>
    <div class="dice-container">
        <div class="dice" id="d1"></div>
        <div class="dice" id="d2"></div>
        <div class="dice" id="d3"></div>
    </div>
    <div class="bowl" id="bowl">
        <span style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">IT ZONE</span>
    </div>
</div>

<div class="board" id="board"></div>

<div class="footer">
    <div class="main-row">
        <input type="number" id="betInput" value="5000" inputmode="numeric">
        <button class="btn-roll" onclick="playGame()" id="rollBtn">·ûÄ·üí·ûö·û°·ûª·ûÄ</button>
    </div>
    <div style="font-size: 0.7rem; color: #94a3b8;">Supported by Yah Rapha X Master Care</div>
</div>

<audio id="bgMusic" loop preload="auto" src="Vip_·ûÖ·û∂·ûÄ·üã·ûî·û∂·ûÄ·üã·ûÖ·û∂·ûâ·üã·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã_Break_Mix_Deeje_Kun_Drc_Ft_Mrr_Body_Black.mp3"></audio>
<audio id="ambientSound" loop preload="auto" src="https://www.soundjay.com/misc/sounds/crowd-talking-1.mp3"></audio>
<audio id="rollSnd" preload="auto" src="https://www.soundjay.com/misc/sounds/dice-roll-1.mp3"></audio>
<audio id="winSnd" preload="auto" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>

<script>
    const animals = [
        { id: 'tiger', name: '·ûÅ·üí·ûõ·û∂', img: 'tiger.png' },
        { id: 'gourd', name: '·ûÉ·üí·ûõ·üÑ·ûÄ', img: 'gourd.png' },
        { id: 'chicken', name: '·ûò·û∂·ûì·üã', img: 'chicken.png' },
        { id: 'shrimp', name: '·ûî·ûÑ·üí·ûÄ·ûÑ', img: 'shrimp.png' },
        { id: 'fish', name: '·ûè·üí·ûö·û∏', img: 'fish.png' },
        { id: 'crab', name: '·ûÄ·üí·ûè·û∂·ûò', img: 'crab.png' }
    ];

    let balance = 100000;
    let bets = {};
    let isAudioInitialized = false;

    function init() {
        const board = document.getElementById('board');
        board.innerHTML = '';
        animals.forEach(a => {
            board.innerHTML += `
                <div class="card" id="c-${a.id}" onclick="placeBet('${a.id}')">
                    <div class="bet-badge" id="b-${a.id}" style="display:none">0</div>
                    <img src="${a.img}" onerror="this.src='https://via.placeholder.com/100?text=${a.name}'">
                    <div style="font-size:0.8rem; font-weight:bold; margin-top:5px; color:var(--gold)">${a.name}</div>
                </div>
            `;
        });
        updateUI();
    }

    // THIS IS THE FIX FOR PHONES
    function initAudio() {
        if (isAudioInitialized) return;
        const sounds = ['bgMusic', 'ambientSound', 'rollSnd', 'winSnd'];
        sounds.forEach(id => {
            const a = document.getElementById(id);
            a.play().then(() => { a.pause(); a.currentTime = 0; }).catch(() => {});
        });
        isAudioInitialized = true;
    }

    function manualToggle(id) {
        initAudio(); // Unlock audio on first tap
        const audio = document.getElementById(id);
        const status = document.getElementById(id === 'bgMusic' ? 'bgStatus' : 'amStatus');
        
        if (audio.paused) {
            audio.play();
            status.textContent = "ON";
            status.style.color = "var(--green)";
        } else {
            audio.pause();
            status.textContent = "OFF";
            status.style.color = "var(--red)";
        }
    }

    function placeBet(id) {
        initAudio(); // Unlock audio on first bet
        let amt = parseInt(document.getElementById('betInput').value);
        if (balance < amt) return;
        balance -= amt;
        bets[id] = (bets[id] || 0) + amt;
        updateUI();
    }

    function playGame() {
        if (Object.keys(bets).length === 0) return alert("·ûü·ûº·ûò·ûÖ·û∂·ûÄ·üã·ûü·û∑·ûì!");
        initAudio(); // Ensure unlocked
        
        const btn = document.getElementById('rollBtn');
        const bowl = document.getElementById('bowl');
        const rollSnd = document.getElementById('rollSnd');

        btn.disabled = true;
        bowl.classList.remove('open');
        rollSnd.play();

        setTimeout(() => {
            bowl.classList.add('shaking');
            setTimeout(() => {
                bowl.classList.remove('shaking');
                let res = [];
                for(let i=1; i<=3; i++) {
                    const a = animals[Math.floor(Math.random()*6)];
                    res.push(a.id);
                    document.getElementById('d'+i).innerHTML = `<img src="${a.img}">`;
                }
                bowl.classList.add('open');
                checkResult(res);
                btn.disabled = false;
            }, 1200);
        }, 100);
    }

    function checkResult(res) {
        let win = 0;
        for(let id in bets) {
            const count = res.filter(r => r === id).length;
            if (count > 0) win += bets[id] + (bets[id] * count);
        }

        const m = document.getElementById('msg');
        m.style.display = 'block';
        if (win > 0) {
            balance += win;
            document.getElementById('winSnd').play();
            m.style.background = 'var(--green)';
            m.innerHTML = `·ûà·üí·ûì·üá ${win.toLocaleString()}·üõ`;
        } else {
            m.style.background = 'var(--red)';
            m.textContent = "·ûò·û∑·ûì·ûè·üí·ûö·ûº·ûú·ûë·üÅ!";
        }
        setTimeout(() => { m.style.display = 'none'; }, 2500);
        bets = {};
        updateUI();
    }

    function updateUI() {
        document.getElementById('balance').textContent = balance.toLocaleString();
        animals.forEach(a => {
            const b = document.getElementById('b-'+a.id);
            if (bets[a.id]) {
                b.style.display = 'block';
                b.textContent = (bets[a.id]/1000) + "k";
            } else { b.style.display = 'none'; }
        });
    }

    init();
</script>
</body>
</html>
